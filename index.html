<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adoption Intelligence - Conversational Agent</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #0b1021;
      --card: #11172e;
      --primary: #58d3ff;
      --secondary: #8c7bff;
      --accent: #2ee6a8;
      --text: #e8ecf5;
      --muted: #a5afc9;
      --glow: 0 10px 40px rgba(88, 211, 255, 0.25);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(88, 211, 255, 0.08), transparent 35%),
                  radial-gradient(circle at 80% 0%, rgba(140, 123, 255, 0.09), transparent 40%),
                  radial-gradient(circle at 50% 70%, rgba(46, 230, 168, 0.07), transparent 45%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      padding: 36px 64px 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(11,16,33,0.95) 0%, rgba(11,16,33,0.70) 100%);
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: 0.4px;
      text-transform: uppercase;
    }

    .pulse {
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      position: relative;
    }
    .pulse::after {
      content: '';
      position: absolute;
      inset: -8px;
      border-radius: 50%;
      border: 1px solid rgba(46, 230, 168, 0.5);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(0.6); opacity: 0.7; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    .actions { display: flex; align-items: center; gap: 12px; }
    .btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #0b1021;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .btn:hover { transform: translateY(-1px) scale(1.01); box-shadow: 0 10px 35px rgba(140, 123, 255, 0.25); }
    .btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: none;
    }

    .page-nav {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 14px;
      padding: 6px;
      width: fit-content;
    }
    .page-tab {
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
    }
    .page-tab.active { background: linear-gradient(135deg, rgba(88,211,255,0.15), rgba(140,123,255,0.15)); color: var(--text); }

    main { padding: 0 64px 64px; }

    .grid { display: grid; gap: 16px; }
    .metrics { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02) 0%, rgba(255,255,255,0) 100%);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 16px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    }
    .panel::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 20%, rgba(88,211,255,0.08), transparent 40%);
      opacity: 0.6;
      pointer-events: none;
    }
    .panel h3 { margin: 0; font-size: 15px; color: var(--muted); letter-spacing: 0.2px; }
    .panel .value { margin-top: 12px; font-size: 32px; font-weight: 700; }
    .trend { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-size: 13px; font-weight: 600; background: rgba(46, 230, 168, 0.12); color: #9cf2cc; }
    .trend.down { background: rgba(255, 109, 96, 0.12); color: #ffb5ae; }

    .section-title { margin: 32px 0 12px; font-size: 18px; letter-spacing: 0.3px; display: flex; align-items: center; gap: 10px; }
    .section-title span { width: 4px; height: 20px; border-radius: 6px; background: linear-gradient(180deg, var(--primary), var(--secondary)); display: inline-block; }

    .chart-card { padding: 20px; }

    .usage-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .usage-item { display: flex; flex-direction: column; gap: 8px; padding: 14px; border-radius: 12px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); }
    .usage-header { display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: var(--muted); }
    .progress { height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06); overflow: hidden; }
    .progress-bar { height: 100%; border-radius: 999px; background: linear-gradient(90deg, var(--primary), var(--secondary)); }

    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { padding: 6px 10px; border-radius: 10px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); color: var(--muted); font-size: 13px; }

    .feedback-shell { display: flex; flex-direction: column; gap: 16px; }
    .feedback-surface { padding: 22px; border-radius: 18px; background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0)); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 24px 80px rgba(0,0,0,0.45); position: relative; overflow: hidden; }
    .feedback-surface::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 18% 20%, rgba(255,109,96,0.18), transparent 42%), radial-gradient(circle at 82% 28%, rgba(88,211,255,0.12), transparent 38%), radial-gradient(circle at 60% 90%, rgba(140,123,255,0.12), transparent 36%); opacity: 0.9; pointer-events: none; }
    .feedback-canvas { display: grid; grid-template-columns: 0.78fr 1fr 1fr; gap: 18px; position: relative; z-index: 1; align-items: start; }
    .feedback-col { background: rgba(11,16,33,0.55); border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 18px; display: flex; flex-direction: column; gap: 12px; backdrop-filter: blur(6px); box-shadow: var(--glow); overflow: visible; position: relative; }
    .thumb-hero { display: flex; gap: 12px; align-items: center; }
    .thumb-icon { width: 64px; height: 64px; border-radius: 16px; display: grid; place-items: center; font-size: 32px; background: radial-gradient(circle at 30% 30%, rgba(255,109,96,0.45), rgba(255,109,96,0.18)); border: 1px solid rgba(255,109,96,0.35); box-shadow: 0 16px 40px rgba(255,109,96,0.25); }
    .eyebrow { text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; color: #ffb5ae; font-weight: 800; }
    .feedback-value { font-size: 54px; font-weight: 800; letter-spacing: -0.6px; margin-top: 4px; }
    .feedback-sub { color: var(--muted); font-weight: 600; }
    .column-title { font-weight: 800; letter-spacing: 0.4px; color: var(--muted); text-transform: uppercase; font-size: 12px; display: flex; align-items: center; gap: 8px; }
    .column-title::before { content: ''; width: 8px; height: 8px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); box-shadow: 0 0 0 6px rgba(88,211,255,0.12); }
    .macro-list, .remediation-list { display: flex; flex-direction: column; gap: 14px; }
    .macro-card, .remediation-card { padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.03); position: relative; overflow: hidden; --tone: var(--primary); min-height: 76px; display: flex; align-items: center; }
    .macro-card::after, .remediation-card::after { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(88,211,255,0.05), rgba(140,123,255,0.05)); opacity: 0.8; pointer-events: none; }
    .connector-bridge { position: absolute; right: -38px; top: 50%; transform: translateY(-50%); height: 4px; width: 66px; background: linear-gradient(90deg, color-mix(in srgb, var(--tone) 80%, rgba(255,255,255,0)) 0%, color-mix(in srgb, var(--tone) 98%, rgba(255,255,255,0)) 100%); border-radius: 999px; box-shadow: 0 8px 26px rgba(0,0,0,0.28); pointer-events: none; }
    .connector-bridge::after { content: ''; position: absolute; right: -12px; top: 50%; transform: translateY(-50%); width: 12px; height: 12px; border-radius: 50%; background: color-mix(in srgb, var(--tone) 85%, transparent); box-shadow: 0 0 0 8px rgba(11,16,33,0.9), 0 10px 26px rgba(0,0,0,0.32); border: 1px solid color-mix(in srgb, var(--tone) 55%, transparent); }
    .macro-name { font-weight: 800; letter-spacing: 0.2px; display: flex; align-items: center; gap: 10px; }
    .swatch { width: 12px; height: 12px; border-radius: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.22); }
    .remediation-card { padding-left: 16px; border-left: 3px solid color-mix(in srgb, var(--tone) 68%, transparent); box-shadow: 0 14px 36px rgba(0,0,0,0.22); }
    .remediation-card::before { content: ''; position: absolute; top: 50%; left: -22px; transform: translateY(-50%); width: 18px; height: 18px; border-radius: 10px; background: radial-gradient(circle, var(--tone) 0%, color-mix(in srgb, var(--tone) 65%, transparent) 70%); box-shadow: 0 0 0 8px rgba(11,16,33,0.85), 0 10px 28px rgba(0,0,0,0.35); border: 1px solid color-mix(in srgb, var(--tone) 65%, transparent); }
    .remediation-text { color: var(--muted); font-weight: 600; line-height: 1.6; }

    @media (max-width: 1080px) {
      .feedback-canvas { grid-template-columns: 1fr; }
      .connector-bridge { display: none; }
    }

    .page { display: none; }
    .page.active { display: block; animation: fadeIn 220ms ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 960px) {
      header { padding: 28px 24px 18px; }
      main { padding: 0 24px 32px; }
      .top-bar { flex-direction: column; align-items: flex-start; }
    }
    @media (max-width: 640px) {
      .actions { width: 100%; }
      .btn { flex: 1; text-align: center; }
      .page-nav { width: 100%; justify-content: space-between; }
      .page-tab { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="brand">
        <div class="pulse"></div>
        <div>
          <div style="color: var(--muted); font-size: 12px;">Realtime adoption</div>
          <div style="font-size: 18px;">Conversation AI Command Center</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn secondary" onclick="refreshData()">Aggiorna snapshot</button>
        <button class="btn">Esporta report</button>
      </div>
    </div>
    <div class="page-nav">
      <button class="page-tab active" data-target="qualitativa">Analisi qualitativa</button>
      <button class="page-tab" data-target="feedback">Feedback analysis</button>
      <button class="page-tab" data-target="quantitativa">Analisi quantitativa</button>
    </div>
  </header>

  <main>
    <section class="page active" id="page-qualitativa">
      <div class="grid metrics">
        <div class="panel">
          <h3>Utenti unici</h3>
          <div class="value" id="usersValue">12.430</div>
          <div class="trend" id="usersTrend">+8,2% vs 7g</div>
        </div>
        <div class="panel">
          <h3>Interazioni</h3>
          <div class="value" id="interactionsValue">184.290</div>
          <div class="trend" id="interactionsTrend">+5,4% vs 7g</div>
        </div>
        <div class="panel">
          <h3>Sessioni</h3>
          <div class="value" id="sessionsValue">42.780</div>
          <div class="trend" id="sessionsTrend">+3,1% vs 7g</div>
        </div>
        <div class="panel">
          <h3>Tempo medio sessione</h3>
          <div class="value" id="avgSessionValue">9m 12s</div>
          <div class="trend" id="avgSessionTrend">+0,6m vs 7g</div>
        </div>
        <div class="panel">
          <h3>Tasso di ritorno</h3>
          <div class="value" id="returnRateValue">37,4%</div>
          <div class="trend" id="returnRateTrend">+2,1 pt vs 7g</div>
        </div>
      </div>

      <div class="section-title"><span></span>Andamento settimanale</div>
      <div class="grid" style="grid-template-columns: 2fr 1fr; gap: 16px; align-items: stretch;">
        <div class="panel chart-card">
          <canvas id="trendChart" height="120"></canvas>
        </div>
        <div class="panel chart-card">
          <h3>Pulse qualitativo</h3>
          <div class="chips" style="margin-top: 8px;">
            <div class="chip">Top intent: briefing prodotto</div>
            <div class="chip">Tono: 74% positivo</div>
            <div class="chip">Escalation umane: 3,8%</div>
            <div class="chip">Risposte 1st try: 86%</div>
          </div>
        </div>
      </div>

      <div class="section-title"><span></span>Insights rapidi</div>
      <div class="chips">
        <div class="chip">Peak: martedÃ¬ 10:00-12:00</div>
        <div class="chip">42% delle ricerche includono fonti web</div>
        <div class="chip">Tempo medio sessione: 9m 12s</div>
        <div class="chip">Top team: Product, Sales Enablement</div>
        <div class="chip">Conversazioni audio +31% WoW</div>
      </div>
    </section>

    <section class="page" id="page-feedback">
      <div class="section-title"><span></span>Feedback analysis</div>
      <div class="feedback-shell">
        <div class="feedback-surface">
          <div class="feedback-canvas">
            <div class="feedback-col">
              <div class="thumb-hero">
                <div class="thumb-icon">ðŸ‘Ž</div>
                <div>
                  <div class="eyebrow">Thumbs down</div>
                  <div class="feedback-value">1.420</div>
                  <div class="feedback-sub">pollici in giÃ¹ su 184.290 interazioni</div>
                </div>
              </div>
            </div>

            <div class="feedback-col" style="gap: 18px;">
              <div class="column-title" style="margin: 0 0 4px;">Macrocategorie di errore</div>
              <div class="macro-list">
                <div class="macro-card" style="--tone:#ff6d60;">
                  <div class="macro-name"><div class="swatch" style="background:#ff6d60;"></div>Hallucinazione dati</div>
                  <div class="connector-bridge"></div>
                </div>
                <div class="macro-card" style="--tone:#58d3ff;">
                  <div class="macro-name"><div class="swatch" style="background:#58d3ff;"></div>Incomprensione intenti</div>
                  <div class="connector-bridge"></div>
                </div>
                <div class="macro-card" style="--tone:#8c7bff;">
                  <div class="macro-name"><div class="swatch" style="background:#8c7bff;"></div>Latency percepita</div>
                  <div class="connector-bridge"></div>
                </div>
                <div class="macro-card" style="--tone:#2ee6a8;">
                  <div class="macro-name"><div class="swatch" style="background:#2ee6a8;"></div>Stile non conforme</div>
                  <div class="connector-bridge"></div>
                </div>
              </div>
            </div>

            <div class="feedback-col" style="gap: 18px;">
              <div class="column-title" style="margin: 0 0 4px;">Remediation action</div>
              <div class="remediation-list">
                <div class="remediation-card" style="--tone:#ff6d60;">
                  <div class="remediation-text">Raffinare grounding con fonti interne e reranker semantico.</div>
                </div>
                <div class="remediation-card" style="--tone:#58d3ff;">
                  <div class="remediation-text">Ampliare training set conversazionale e prompt di disambiguazione.</div>
                </div>
                <div class="remediation-card" style="--tone:#8c7bff;">
                  <div class="remediation-text">Cache sugli intenti frequenti e parallelizzazione retrieval.</div>
                </div>
                <div class="remediation-card" style="--tone:#2ee6a8;">
                  <div class="remediation-text">Policy di tono pre-compilate e controllo finale sul response planner.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="page" id="page-quantitativa">
      <div class="section-title"><span></span>Analisi quantitativa</div>
      <div class="grid metrics">
        <div class="panel">
          <h3>Utenti settimanali</h3>
          <div class="value" id="weeklyUsers">8.940</div>
          <div class="trend" id="weeklyUsersTrend">+6,1% vs 7g</div>
        </div>
        <div class="panel">
          <h3>Interazioni / sessione</h3>
          <div class="value" id="perSession">4,3</div>
          <div class="trend" id="perSessionTrend">+0,2 vs 7g</div>
        </div>
        <div class="panel">
          <h3>Completion rate</h3>
          <div class="value" id="completion">91%</div>
          <div class="trend" id="completionTrend">+1,4 pt vs 7g</div>
        </div>
        <div class="panel">
          <h3>Latency p95</h3>
          <div class="value" id="latency">2,4s</div>
          <div class="trend down" id="latencyTrend">-0,2s vs 7g</div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns: 1.2fr 1fr; gap: 16px; align-items: stretch;">
        <div class="panel chart-card">
          <h3>Mix di utilizzo</h3>
          <canvas id="usageChart" height="200"></canvas>
        </div>
        <div class="panel chart-card">
          <h3>Sessioni per fascia oraria</h3>
          <canvas id="timeChart" height="200"></canvas>
        </div>
      </div>

      <div class="section-title"><span></span>Tipologie di utilizzo</div>
      <div class="grid usage-grid" id="usageGrid"></div>
    </section>
  </main>

  <script>
    const pages = document.querySelectorAll('.page');
    const tabs = document.querySelectorAll('.page-tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => switchPage(tab.dataset.target));
    });

    function switchPage(target) {
      tabs.forEach(t => t.classList.toggle('active', t.dataset.target === target));
      pages.forEach(p => p.classList.toggle('active', p.id === `page-${target}`));
    }

    const usageBreakdown = [
      { label: 'Ricerca web', value: 22, color: '#58d3ff' },
      { label: 'Traduzione', value: 9, color: '#8c7bff' },
      { label: 'Drafting', value: 18, color: '#2ee6a8' },
      { label: 'Summarization', value: 14, color: '#ffae63' },
      { label: 'Comparazione', value: 8, color: '#ff6d60' },
      { label: 'Key point extraction', value: 7, color: '#7ce7c7' },
      { label: 'Generazione immagini', value: 12, color: '#e76bff' },
      { label: 'FunzionalitÃ  audio', value: 10, color: '#5ce0c5' },
    ];

    const usageGrid = document.getElementById('usageGrid');
    usageBreakdown.forEach(item => {
      const el = document.createElement('div');
      el.className = 'usage-item';
      el.innerHTML = `
        <div class="usage-header">
          <span>${item.label}</span>
          <strong>${item.value}%</strong>
        </div>
        <div class="progress"><div class="progress-bar" style="width:${item.value}%; background:${item.color}"></div></div>
      `;
      usageGrid.appendChild(el);
    });

    const trendCtx = document.getElementById('trendChart');
    const usageCtx = document.getElementById('usageChart');
    const timeCtx = document.getElementById('timeChart');

    const labels = ['Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'];
    const baseTrend = [120, 145, 162, 150, 178, 190, 205];
    const baseSessions = [32, 36, 34, 35, 37, 40, 43];

    const gradient = trendCtx.getContext('2d').createLinearGradient(0, 0, 0, 220);
    gradient.addColorStop(0, 'rgba(88, 211, 255, 0.35)');
    gradient.addColorStop(1, 'rgba(88, 211, 255, 0)');

    const trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Interazioni (k)',
            data: baseTrend,
            borderColor: '#58d3ff',
            backgroundColor: gradient,
            fill: true,
            tension: 0.35,
            borderWidth: 2.4,
            pointRadius: 4,
            pointBackgroundColor: '#0b1021',
            pointBorderColor: '#58d3ff'
          },
          {
            label: 'Sessioni (k)',
            data: baseSessions,
            borderColor: '#8c7bff',
            backgroundColor: 'transparent',
            fill: false,
            tension: 0.35,
            borderWidth: 2,
            pointRadius: 3,
            pointBackgroundColor: '#8c7bff',
            pointBorderColor: '#8c7bff'
          }
        ]
      },
      options: {
        plugins: {
          legend: { labels: { color: '#d9e1f7' }, position: 'top' },
          tooltip: {
            backgroundColor: '#11172e',
            borderColor: 'rgba(255,255,255,0.08)',
            borderWidth: 1,
            padding: 12,
            titleColor: '#fff',
            bodyColor: '#dfe7ff'
          }
        },
        scales: {
          x: { ticks: { color: '#9aa7c7' }, grid: { color: 'rgba(255,255,255,0.04)' } },
          y: { ticks: { color: '#9aa7c7' }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true }
        }
      }
    });

    const usageChart = new Chart(usageCtx, {
      type: 'doughnut',
      data: {
        labels: usageBreakdown.map(u => u.label),
        datasets: [{
          data: usageBreakdown.map(u => u.value),
          backgroundColor: usageBreakdown.map(u => u.color),
          borderWidth: 1,
          borderColor: '#0b1021'
        }]
      },
      options: {
        cutout: '60%',
        plugins: {
          legend: { position: 'bottom', labels: { color: '#d9e1f7', boxWidth: 12, padding: 14 } },
          tooltip: {
            backgroundColor: '#11172e',
            borderColor: 'rgba(255,255,255,0.08)',
            borderWidth: 1,
            padding: 12,
            titleColor: '#fff',
            bodyColor: '#dfe7ff'
          }
        }
      }
    });

    const timeChart = new Chart(timeCtx, {
      type: 'line',
      data: {
        labels: ['08', '10', '12', '14', '16', '18', '20', '22'],
        datasets: [{
          label: 'Sessioni (k)',
          data: [2.4, 3.1, 3.6, 3.3, 3.8, 4.1, 2.9, 1.6],
          borderColor: '#2ee6a8',
          backgroundColor: 'rgba(46, 230, 168, 0.15)',
          fill: true,
          tension: 0.35,
          borderWidth: 2.4,
          pointRadius: 3,
          pointBackgroundColor: '#0b1021',
          pointBorderColor: '#2ee6a8'
        }]
      },
      options: {
        plugins: { legend: { display: false }, tooltip: { backgroundColor: '#11172e', titleColor: '#fff', bodyColor: '#dfe7ff' } },
        scales: {
          x: { ticks: { color: '#9aa7c7' }, grid: { color: 'rgba(255,255,255,0.04)' } },
          y: { ticks: { color: '#9aa7c7' }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: true }
        }
      }
    });

    function refreshData() {
      const delta = () => (Math.random() * 8 - 4).toFixed(1);
      const percentDelta = () => (Math.random() * 4 - 2).toFixed(1);

      const updateMetric = (id, base, formatter = v => v.toLocaleString('it-IT')) => {
        const variation = delta();
        const value = Math.max(base + Number(variation) * 120, base * 0.9);
        document.getElementById(id).textContent = formatter(value);
        return variation;
      };

      const usersVar = updateMetric('usersValue', 12430);
      const interactionsVar = updateMetric('interactionsValue', 184290);
      const sessionsVar = updateMetric('sessionsValue', 42780);

      const avgSessionBase = 9.2 + Number(percentDelta());
      document.getElementById('avgSessionValue').textContent = `${avgSessionBase.toFixed(1)}m`;
      const returnRateBase = Math.max(30, Math.min(50, 37.4 + Number(percentDelta())));
      document.getElementById('returnRateValue').textContent = `${returnRateBase.toFixed(1)}%`;

      const setTrend = (id, value, suffix = '% vs 7g') => {
        const el = document.getElementById(id);
        const positive = parseFloat(value) >= 0;
        el.textContent = `${positive ? '+' : ''}${value}${suffix}`;
        el.className = 'trend ' + (positive ? '' : 'down');
      };

      setTrend('usersTrend', usersVar);
      setTrend('interactionsTrend', interactionsVar);
      setTrend('sessionsTrend', sessionsVar);
      setTrend('avgSessionTrend', percentDelta(), 'm vs 7g');
      setTrend('returnRateTrend', percentDelta(), ' pt vs 7g');

      const usageNoise = usageBreakdown.map(u => Math.max(4, Math.min(25, u.value + Number(percentDelta()))));
      const usageTotal = usageNoise.reduce((a,b) => a + b, 0);
      const normalized = usageNoise.map(v => Math.round((v / usageTotal) * 100));
      usageChart.data.datasets[0].data = normalized;
      usageChart.update();
      Array.from(usageGrid.children).forEach((el, idx) => {
        const val = normalized[idx];
        el.querySelector('strong').textContent = `${val}%`;
        el.querySelector('.progress-bar').style.width = `${val}%`;
      });

      const weeklyUsersVar = updateMetric('weeklyUsers', 8940);
      setTrend('weeklyUsersTrend', weeklyUsersVar);
      setTrend('perSessionTrend', percentDelta());
      setTrend('completionTrend', percentDelta(), ' pt vs 7g');
      setTrend('latencyTrend', (Math.random() * -0.8).toFixed(1), 's vs 7g');
    }
  </script>
</body>
</html>
